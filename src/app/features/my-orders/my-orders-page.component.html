<div class="my-orders-page">

  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>

  <app-page-header [title]="('PAGES.MY_ORDERS.SECTION_TITLE' | translate)"></app-page-header>

  <app-loading-spinner [message]="( 'COMMON.LOADING' | translate )" *ngIf="loading()"></app-loading-spinner>

  <app-error-state 
    *ngIf="error() && !loading()"
    [title]="'PAGES.MY_ORDERS.LOADING_ERROR' | translate"
    [message]="error() || ( 'ERRORS.GENERAL' | translate )"
    [retryButtonText]="'COMMON.RETRY' | translate"
    (retry)="handleRetry()">
  </app-error-state>

  <app-empty-state 
    *ngIf="!loading() && !error() && orders().length === 0"
    [title]="'PAGES.MY_ORDERS.EMPTY_TITLE' | translate"
    [message]="'PAGES.MY_ORDERS.EMPTY_DESC' | translate"
    icon="fa-shopping-bag"
    [actionText]="'COMMON.BACK_TO_HOME' | translate"
    actionRoute="/">
  </app-empty-state>  

  <div *ngIf="!loading() && !error() && orders().length > 0" class="orders-container">
    
    <div class="orders-grid">
      <div 
        *ngFor="let order of orders()" 
        class="order-card"
        (click)="viewOrderDetail(order.id)"
      >
        <div class="order-card-header">
          <div class="order-info">
            <span class="order-title">{{'COMMON.ORDER' | translate}}</span>
            <span class="order-id">
              <i class="fas fa-hashtag"></i>{{ order.public_id }}
            </span>
            <span class="order-date">
              <i class="far fa-calendar"></i>
              {{ formatDate(order.created_at) }}
            </span>
          </div>
          <div class="order-status">
            <button class="btn btn-details btn-sm">
              <i class="fas fa-eye"></i>
              {{ 'COMMON.VIEW_DETAILS' | translate }}
            </button>
            <span class="status-badge" [ngClass]="'status-' + order.status">
              {{ getStatusLabel(order.status) }}
            </span>
          </div>
        </div>

        <div class="order-card-body">
          <div class="order-details">
            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-box"></i>
                <span>{{ 'PAGES.MY_ORDERS.LISTINGS' | translate }}</span>
              </div>
              <div 
                *ngFor="let item of order.items" 
                class="order-items"
              >     
                <div class="order-item">{{ item.quantity }} &times; {{ item.listing_title }}</div>
              </div>
            </div>
            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-credit-card"></i>
                <span>{{ 'PAGES.MY_ORDERS.PAYMENT_STATUS' | translate }}</span>
              </div>              
              <span 
                class="payment-status" 
                [ngClass]="'payment-' + order.payment_status"
              >
                {{ getPaymentStatusLabel(order.payment_status) }}
              </span>
            </div>
            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-truck"></i>
                <span>{{ 'PAGES.MY_ORDERS.DELIVERY_METHOD' | translate }}</span>
              </div>               
              <span>{{ order.delivery_method.name }}</span>
            </div>  
            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-dollar-sign"></i>
                <span>{{ 'PAGES.MY_ORDERS.TOTAL' | translate }}</span>
              </div>               
              <span class="total-value">${{ getFormattedPrice(order.total) }}</span>
            </div>          
          </div>                   
        </div>        
      </div>
    </div>

    <div class="pagination-container" *ngIf="totalPages > 1">
      <app-pagination
        [currentPage]="currentPage"
        [totalPages]="totalPages"
        [totalItems]="totalItems"
        (pageChange)="onPageChange($event)"
      ></app-pagination>
    </div>

  </div>
</div>