<div class="search-page">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>

  <!-- Header de la página -->
  <div class="search-header">
    <h1 class="search-title">
      <span *ngIf="searchResult?.query">
        {{ 'SEARCH.RESULTS_FOR' | translate }}: "<strong>{{ searchResult?.query }}</strong>"
      </span>
      <span *ngIf="!searchResult?.query">
        {{ 'SEARCH.TITLE' | translate }}
      </span>
    </h1>
    
    <div class="search-meta" *ngIf="searchResult">
      <p class="results-count">
        <span *ngIf="searchResult.pagination.total > 0">
          {{ searchResult.pagination.total }} {{ 'SEARCH.RESULTS_FOUND' | translate }}
        </span>
        <span *ngIf="searchResult.pagination.total === 0">
          {{ 'SEARCH.NO_RESULTS' | translate }}
        </span>
      </p>
    </div>
  </div>

  <!-- Contenido principal -->
  <div class="search-content">
    <!-- Sidebar con filtros -->
    <aside class="search-filters">
      <div class="filters-card">
        <div class="filters-header">
          <h3>{{ 'SEARCH.FILTERS' | translate }}</h3>
          <button 
            type="button" 
            class="btn-clear-filters" 
            *ngIf="hasActiveFilters"
            (click)="clearFilters()">
            {{ 'SEARCH.CLEAR_FILTERS' | translate }}
          </button>
        </div>

        <form [formGroup]="searchForm" class="filters-form">
          <!-- Filtro por categoría -->
          <div class="filter-group">
            <label for="category">{{ 'SEARCH.CATEGORY' | translate }}</label>
            <select id="category" formControlName="category_id" class="form-select">
              <option value="">{{ 'SEARCH.ALL_CATEGORY' | translate }}</option>
              <option *ngFor="let category of categories" [value]="category.id">
                {{ category.name }}
              </option>
            </select>
          </div>

          <!-- Filtro por precio mínimo -->
          <div class="filter-group">
            <label for="minPrice">{{ 'SEARCH.MIN_PRICE' | translate }}</label>
            <input 
              type="number" 
              id="minPrice" 
              formControlName="min_price" 
              class="form-input"
              min="0"
              step="0.01"
              placeholder="0.00">
          </div>

          <!-- Filtro por precio máximo -->
          <div class="filter-group">
            <label for="maxPrice">{{ 'SEARCH.MAX_PRICE' | translate }}</label>
            <input 
              type="number" 
              id="maxPrice" 
              formControlName="max_price" 
              class="form-input"
              min="0"
              step="0.01"
              placeholder="999.99">
          </div>
        </form>

        <!-- Filtros activos -->
        <div class="active-filters" *ngIf="hasActiveFilters">
          <h4>{{ 'SEARCH.ACTIVE_FILTERS' | translate }}</h4>
          <div class="filter-tags">
            <span class="filter-tag" *ngIf="searchForm.value.category_id">
              {{ getCategoryName(searchForm.value.category_id) }}
              <button type="button" (click)="searchForm.patchValue({category_id: ''})">×</button>
            </span>
            <span class="filter-tag" *ngIf="searchForm.value.min_price">
              {{ 'SEARCH.MIN' | translate }}: ${{ searchForm.value.min_price }}
              <button type="button" (click)="searchForm.patchValue({min_price: ''})">×</button>
            </span>
            <span class="filter-tag" *ngIf="searchForm.value.max_price">
              {{ 'SEARCH.MAX' | translate }}: ${{ searchForm.value.max_price }}
              <button type="button" (click)="searchForm.patchValue({max_price: ''})">×</button>
            </span>
          </div>
        </div>
      </div>
    </aside>

    <!-- Área de resultados -->
    <main class="search-results">      

      <!-- Resultados -->
      <div *ngIf="!loading && searchResult" class="results-container">
        <!-- Grid de productos -->
        <div class="listings-grid" *ngIf="searchResult.items.length > 0">
          <app-listing-card 
            *ngFor="let listing of searchResult.items; trackBy: trackByListingId"
            [listing]="listing">
          </app-listing-card>
        </div>

        <!-- Sin resultados -->
        <div class="no-results" *ngIf="searchResult.items.length === 0">
          <div class="no-results-content">
            <div class="no-results-icon">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
              </svg>
            </div>
            <h3>{{ 'SEARCH.EMPTY_TITLE' | translate }}</h3>
            <p>{{ 'SEARCH.EMPTY_MESSAGE' | translate }}</p>            
          </div>
        </div>

        <!-- Paginación -->
        <app-pagination 
          *ngIf="searchResult.items.length > 0"
          [currentPage]="searchResult.pagination.page"
          [totalPages]="searchResult.pagination.total_pages"          
          [totalItems]="searchResult.pagination.total"          
          (pageChange)="onPageChange($event)">
        </app-pagination>
      </div>

      <!-- Estado inicial (sin búsqueda) -->
      <div *ngIf="!loading && !searchResult" class="search-empty">
        <div class="search-empty-content">
          <div class="search-empty-icon">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </div>
          <h3>{{ 'SEARCH.EMPTY_TITLE' | translate }}</h3>
          <p>{{ 'SEARCH.EMPTY_MESSAGE' | translate }}</p>
        </div>
      </div>
    </main>
  </div>
</div>