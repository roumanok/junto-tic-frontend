<div class="my-sales-page">
  
  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>

  <app-page-header [title]="('PAGES.MY_SALES.SECTION_TITLE' | translate)"></app-page-header>
  
  <app-my-sales-mini-stats></app-my-sales-mini-stats>

  <app-loading-spinner [message]="( 'COMMON.LOADING' | translate )" *ngIf="loading()"></app-loading-spinner>

  <app-error-state 
    *ngIf="error() && !loading()"
    [title]="'PAGES.MY_SALES.LOADING_ERROR' | translate"
    [message]="error() || ( 'ERRORS.GENERAL' | translate )"
    [retryButtonText]="'COMMON.RETRY' | translate"
    (retry)="loadSales()">
  </app-error-state>  

  <app-empty-state 
    *ngIf="!loading() && !error() && sales().length === 0"
    [title]="'PAGES.MY_SALES.EMPTY_TITLE' | translate"
    [message]="'PAGES.MY_SALES.EMPTY_DESC' | translate"
    icon="fa-shopping-bag"
    [actionText]="'COMMON.BACK_TO_HOME' | translate"
    actionRoute="/">
  </app-empty-state> 
  
  <div *ngIf="!loading() && !error() && sales().length > 0" class="sales-container">  

    <div class="sales-grid">
      <div 
        *ngFor="let sale of sales()" 
        class="sale-card"
        (click)="viewOrderDetail(sale.id)"
      >
        <div class="sale-card-header">
          <div class="sale-info">
            <span class="sale-title">{{ 'COMMON.ORDER' | translate }}</span>
            <span class="sale-id">
              <i class="fas fa-hashtag"></i>{{ sale.public_id }}
            </span>
            <span class="sale-date">
              <i class="far fa-calendar"></i>
              {{ formatDate(sale.created_at) }}
            </span>
            <span 
                class="payment-status" 
                [ngClass]="'payment-' + sale.payment_status.toLowerCase()"
              >
              <i class="fas fa-credit-card"></i>
               {{ getPaymentStatusLabel(sale.payment_status) }}
              </span>
          </div>
          <div class="sale-status">
            <button class="btn btn-details btn-sm">
              <i class="fas fa-eye"></i>
              {{ 'COMMON.VIEW_DETAILS' | translate }}
            </button>
            <span class="status-badge" [ngClass]="getStatusClass(sale.status)">
              {{ getStatusLabel(sale.status) }}
            </span>
          </div>
        </div>

        <!-- Sale Body -->
        <div class="sale-card-body">
          <div class="sale-details">
            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-user"></i>
                <span>{{ 'PAGES.MY_SALES.CLIENT' | translate }}</span>
              </div>
              <div class="sale-customer">{{ sale.customer_name }}</div>
            </div>

            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-box"></i>
                <span>{{ 'PAGES.MY_SALES.LISTINGS' | translate }}</span>
              </div>
              <div class="sale-items">
                <div class="sale-item">
                  <img 
                    *ngIf="sale.first_item_image" 
                    [src]="getCdnUrl(sale.first_item_image)" 
                    alt="{{ sale.first_item_title }}" 
                    class="item-image"
                  />
                  <div class="item-info">{{ sale.first_item_quantity }} Ã— {{ sale.first_item_title }}</div>
                </div>
              </div>
            </div>

            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-shipping-fast"></i>
                <span>{{ 'PAGES.MY_SALES.DELIVERY_METHOD' | translate }}</span>
              </div>
              <span class="delivery-value">{{ sale.delivery_method.name }}</span>
            </div>
            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-dollar-sign"></i>
                <span>{{ 'PAGES.MY_SALES.TOTAL' | translate }}</span>
              </div>               
              <span class="total-value">{{ formatPrice(sale.total) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <app-pagination
      [currentPage]="currentPage()"
      [totalPages]="totalPages"
      [totalItems]="totalItems()"
      [itemsPerPage]="pageSize"
      [pageSizeOptions]="[5, 10, 25, 50]"
      [showPageSizeSelector]="true"
      (pageChange)="onPageChange($event)"
      (pageSizeChange)="onPageSizeChange($event)"
    ></app-pagination>
    
  </div>
</div>