<div class="my-sales-page">
  <!-- Breadcrumb -->
  <app-breadcrumb [items]="breadcrumbItems"></app-breadcrumb>

  <!-- Page Header -->
  <div class="page-header">
    <div class="container">
      <div class="header-info">
        <h1 class="page-title">
          {{ 'PAGES.MY_SALES.SECTION_TITLE' | translate }}
        </h1>
      </div>
    </div>
  </div>

  <!-- Mini Stats -->
  <app-my-sales-mini-stats></app-my-sales-mini-stats>

  <!-- Loading State -->
  <div *ngIf="loading()" class="loading-container">
    <div class="spinner"></div>
    <p>Cargando tus ventas...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error() && !loading()" class="error-container">
    <i class="fas fa-exclamation-triangle"></i>
    <h3>Error al cargar las ventas</h3>
    <p>{{ error() }}</p>
    <button class="btn btn-primary" (click)="loadSales()">
      Reintentar
    </button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading() && !error() && sales().length === 0" class="empty-state">
    <i class="fas fa-receipt"></i>
    <h3>Aún no tienes ventas</h3>
    <p>Cuando realices tu primera venta, aparecerá acá</p>
    <a routerLink="/mi-cuenta/mis-articulos" class="btn btn-primary">
      Ver mis artículos
    </a>
  </div>

  <!-- Sales List -->
  <div *ngIf="!loading() && !error() && sales().length > 0" class="sales-container">  

    <!-- Sales Grid -->
    <div class="sales-grid">
      <div 
        *ngFor="let sale of sales()" 
        class="sale-card"
        (click)="viewOrderDetail(sale.id)"
      >
        <!-- Sale Header -->
        <div class="sale-card-header">
          <div class="sale-info">
            <span class="sale-title">{{ 'COMMON.ORDER' | translate }}</span>
            <span class="sale-id">
              <i class="fas fa-hashtag"></i>{{ sale.public_id }}
            </span>
            <span class="sale-date">
              <i class="far fa-calendar"></i>
              {{ formatDate(sale.created_at) }}
            </span>
            <span 
                class="payment-status" 
                [ngClass]="'payment-' + sale.payment_status.toLowerCase()"
              >
              <i class="fas fa-credit-card"></i>
               Pago: {{ getPaymentStatusLabel(sale.payment_status) }}
              </span>
          </div>
          <div class="sale-status">
            <button class="btn btn-primary btn-sm">
              <i class="fas fa-eye"></i>
              Ver detalle
            </button>
            <span class="status-badge" [ngClass]="getStatusClass(sale.status)">
              {{ getStatusLabel(sale.status) }}
            </span>
          </div>
        </div>

        <!-- Sale Body -->
        <div class="sale-card-body">
          <div class="sale-details">
            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-user"></i>
                <span>Cliente</span>
              </div>
              <div class="sale-customer">{{ sale.customer_name }}</div>
            </div>

            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-box"></i>
                <span>Productos</span>
              </div>
              <div class="sale-items">
                <div class="sale-item">
                  <img 
                    *ngIf="sale.first_item_image" 
                    [src]="getCdnUrl(sale.first_item_image)" 
                    alt="{{ sale.first_item_title }}" 
                    class="item-image"
                  />
                  <div class="item-info">{{ sale.first_item_quantity }} × {{ sale.first_item_title }}</div>
                </div>
              </div>
            </div>

            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-shipping-fast"></i>
                <span>Método de entrega</span>
              </div>
              <span class="delivery-value">{{ getDeliveryMethodLabel(sale.delivery_method_type) }}</span>
            </div>
            <div class="detail-item">
              <div class="detail-title">
                <i class="fas fa-dollar-sign"></i>
                <span>Total</span>
              </div>               
              <span class="total-value">{{ formatPrice(sale.total) }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <app-pagination
      [currentPage]="currentPage()"
      [totalPages]="totalPages"
      [totalItems]="totalItems()"
      [itemsPerPage]="pageSize"
      [pageSizeOptions]="[5, 10, 25, 50]"
      [showPageSizeSelector]="true"
      (pageChange)="onPageChange($event)"
      (pageSizeChange)="onPageSizeChange($event)"
    ></app-pagination>
  </div>
</div>