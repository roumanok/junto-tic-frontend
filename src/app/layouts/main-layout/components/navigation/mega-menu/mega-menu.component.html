<div class="dropdown-menu no-panel" [class.active]="isOpen">
      <!-- Mobile Header -->
      <div class="mega-mobile-header">                            
        <img 
            [src]="this.themeService.getLogoUrl()" 
            alt="Logo" 
            class="logo-img"
            loading="eager">
        <button class="mega-close-btn" (click)="closeMegaMenu()" aria-label="Cerrar menú">
          {{'COMMON.CLOSE' | translate}}
        </button>
      </div>
      
      <div class="mega-grid" #megaGrid>
        <!-- Left Panel: Categories -->
        <aside class="mega-left">
          <!-- Mobile User Section (Si está logueado) -->          

          <!-- Mobile User Actions (Si NO está logueado) -->
          <div class="mega-mobile-user-actions" *ngIf="isHydrated() && !isLoading() && !isLoggedIn()">
            <button (click)="login()" class="btn-secondary">
              {{'HEADER.MENU.LOGIN' | translate}}
            </button>
            <button (click)="register()" class="btn-primary">
              {{'HEADER.MENU.REGISTER' | translate}}
            </button>
          </div>

          <!-- Mi Cuenta Section (Mobile) - Solo si está logueado -->
          <div class="mega-mobile-account-section" *ngIf="isHydrated() && !isLoading() && isLoggedIn()">
            <div class="account-section-title">
              <i class="fas fa-user-circle"></i>
              {{ 'HEADER.MENU.MY_ACCOUNT' | translate }} - {{ getUsername() }}
            </div>
            
            <ul class="account-menu-mobile">
              <li (click)="navigateToMyOrders()">
                <i class="fas fa-shopping-bag"></i>
                <span>{{ 'HEADER.MENU.MY_ORDERS' | translate }}</span>
                <i class="fas fa-chevron-right arrow"></i>
              </li>
              
              <li *ngIf="hasRole('consumer')" (click)="navigateToSell()">
                <i class="fas fa-store"></i>
                <span>{{ 'HEADER.MENU.SELL' | translate }}</span>
                <i class="fas fa-chevron-right arrow"></i>
              </li>
              
              <li *ngIf="hasRole('advertiser')" (click)="navigateToMySales()">
                <i class="fas fa-chart-line"></i>
                <span>{{ 'HEADER.MENU.MY_SALES' | translate }}</span>
                <i class="fas fa-chevron-right arrow"></i>
              </li>
              
              <li *ngIf="hasRole('advertiser')" (click)="navigateToMyListings()">
                <i class="fas fa-box"></i>
                <span>{{ 'HEADER.MENU.MY_LISTINGS' | translate }}</span>
                <i class="fas fa-chevron-right arrow"></i>
              </li>
              
              <li class="logout-item" (click)="logout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>{{ 'HEADER.MENU.LOGOUT' | translate }}</span>
                <i class="fas fa-chevron-right arrow"></i>
              </li>
            </ul>
          </div>

          <!-- Categorías Title (Mobile) -->
          <div class="mega-mobile-categories-title">
            <i class="fas fa-th-large"></i>
            {{'HEADER.MENU.CATEGORIES' | translate}}
          </div>          
          
          <ul class="mega-parents" #megaParents>
            <li 
              *ngFor="let category of transformedCategories$ | async" 
              [attr.data-panel]="category.id"
              [class.active]="activeCategory === category.id"
              (mouseenter)="onCategoryHover(category.id)"
              (click)="onCategoryClick(category.id, $event)"
            >
              <div class="acc-title">
                {{ category.title }}
                <i class="fa fa-chevron-right chev"></i>
              </div>                                
              
              <!-- Mobile Accordion Content -->
              <div 
                class="acc-children" 
                [attr.data-acc]="category.id"
                [class.open]="openAccordion === category.id"
              >
                <div class="mega-columns">
                  <div 
                    *ngFor="let subcategory of category.subcategories" 
                    class="mega-col"
                  >
                    <h4>
                      <a 
                        [routerLink]="'/categoria/' + getCategorySlug(category.id, subcategory.id)" 
                        (click)="onLinkClick()"
                        class="subcategory-title-link"
                      >
                        {{ subcategory.title }}
                      </a>
                    </h4>
                    <ul class="mega-links" *ngIf="subcategory.links.length > 0">
                      <li *ngFor="let link of subcategory.links">
                        <a [routerLink]="link.url" (click)="onLinkClick()">
                          {{ link.name }}
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </aside>
        
        <!-- Right Panel: Desktop Subcategories -->
        <section class="mega-right" #megaRight>
          <div 
            *ngFor="let category of transformedCategories$ | async" 
            class="mega-panel" 
            [id]="'panel-' + category.id"
            [class.active]="activeCategory === category.id"
          >
            <div class="mega-columns">
              <div 
                *ngFor="let subcategory of category.subcategories" 
                class="mega-col"
              >
                <h4>
                  <a 
                    [routerLink]="'/categoria/' + getCategorySlug(category.id, subcategory.id)" 
                    (click)="onLinkClick()"
                    class="subcategory-title-link"
                  >
                    {{ subcategory.title }}
                  </a>
                </h4>
                <ul class="mega-links" *ngIf="subcategory.links.length > 0">
                  <li *ngFor="let link of subcategory.links">
                    <a [routerLink]="link.url" (click)="onLinkClick()">
                      {{ link.name }}
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>