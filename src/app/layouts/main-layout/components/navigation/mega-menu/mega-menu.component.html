<div class="dropdown-menu no-panel" [class.active]="isOpen">
      <!-- Mobile Header -->
      <div class="mega-mobile-header">                            
        <img 
            [src]="this.themeService.getLogoUrl()" 
            alt="Logo" 
            class="logo-img"
            loading="eager">
        <button class="mega-close-btn" (click)="closeMegaMenu()" aria-label="Cerrar menú">
          {{'COMMON.CLOSE' | translate}}
        </button>
      </div>
      
      <div class="mega-grid" #megaGrid>
        <!-- Left Panel: Categories -->
        <aside class="mega-left">
          <!-- Mobile User Actions -->
          <div class="mega-mobile-user-actions">
            <ng-container *ngIf="isHydrated() && !isLoading()">
              <!-- Si NO está logueado -->
              <ng-container *ngIf="!isLoggedIn()">
                <button (click)="login()" class="btn-secondary">
                  {{'HEADER.MENU.LOGIN' | translate}}
                </button>
                <button (click)="register()" class="btn-primary">
                  {{'HEADER.MENU.REGISTER' | translate}}
                </button>
              </ng-container>
              
              <!-- Si está logueado -->
              <ng-container *ngIf="isLoggedIn()">
                <div class="user-greeting-mobile">{{'HEADER.MENU.HELLO' | translate}}, {{ getUsername() }}</div>
                <button (click)="logout()" class="btn-secondary">
                  {{'HEADER.MENU.LOGOUT' | translate}}
                </button>
              </ng-container>
            </ng-container>
          </div>
          
          <div class="mega-mobile-categories-title">{{'HEADER.MENU.CATEGORIES' | translate}}</div>
          
          <ul class="mega-parents" #megaParents>
            <li 
              *ngFor="let category of transformedCategories$ | async" 
              [attr.data-panel]="category.id"
              [class.active]="activeCategory === category.id"
              (mouseenter)="onCategoryHover(category.id)"
              (click)="onCategoryClick(category.id, $event)"
            >
              <div class="acc-title">
                {{ category.title }}
                <i class="fa fa-chevron-right chev"></i>
              </div>                                
              
              <!-- Mobile Accordion Content -->
              <div 
                class="acc-children" 
                [attr.data-acc]="category.id"
                [class.open]="openAccordion === category.id"
              >
                <div class="mega-columns">
                  <div 
                    *ngFor="let subcategory of category.subcategories" 
                    class="mega-col"
                  >
                    <h4>
                      <a 
                        [routerLink]="'/categoria/' + getCategorySlug(category.id, subcategory.id)" 
                        (click)="onLinkClick()"
                        class="subcategory-title-link"
                      >
                        {{ subcategory.title }}
                      </a>
                    </h4>
                    <ul class="mega-links" *ngIf="subcategory.links.length > 0">
                      <li *ngFor="let link of subcategory.links">
                        <a [routerLink]="link.url" (click)="onLinkClick()">
                          {{ link.name }}
                        </a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </li>
          </ul>
        </aside>
        
        <!-- Right Panel: Desktop Subcategories -->
        <section class="mega-right" #megaRight>
          <div 
            *ngFor="let category of transformedCategories$ | async" 
            class="mega-panel" 
            [id]="'panel-' + category.id"
            [class.active]="activeCategory === category.id"
          >
            <div class="mega-columns">
              <div 
                *ngFor="let subcategory of category.subcategories" 
                class="mega-col"
              >
                <h4>
                  <a 
                    [routerLink]="'/categoria/' + getCategorySlug(category.id, subcategory.id)" 
                    (click)="onLinkClick()"
                    class="subcategory-title-link"
                  >
                    {{ subcategory.title }}
                  </a>
                </h4>
                <ul class="mega-links" *ngIf="subcategory.links.length > 0">
                  <li *ngFor="let link of subcategory.links">
                    <a [routerLink]="link.url" (click)="onLinkClick()">
                      {{ link.name }}
                    </a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>
      </div>
    </div>